# Script for 2.x cruiser sites to generate site manifests


### Rationale

Whenever deploying a new cruiser site one needs to manually create below files in "aic-clcp-site-manifests" which is a repetitive task.

	1. site/$NEW_SITE/site-definition.yaml
	2. site/$NEW_SITE/baremetal/nodes.yaml
	3. site/$NEW_SITE/deployment/deployment-strategy.yaml
	4. site/$NEW_SITE/network/common-addresses.yaml
	5. site/$NEW_SITE/network/control-plane-addresses.yaml
	6. site/$NEW_SITE/pki/kubelet-node-pkicatalog.yaml
	7. site/$NEW_SITE/profiles/region.yaml
	8. site/$NEW_SITE/network/physical/networks.yaml
	9. site/$NEW_SITE/software/config/common-software-config.yaml
	10. site/$NEW_SITE/software/config/corridor.yaml

The script will generate all the above mentioned files for a 2.x cruiser site

### What To Do!


1. Clone 'aic-clcp-manifests' repo to your local and navigate to below directory

                cd aic-clcp-manifests/tools/prepare_site_manifest_cruiser

2. Run the script main.py and enter required parameters as per your site

                python3 main.py

        Example for entering parameters:

                root@stack:/home/stack/script_final# python3 main.py
                Enter site name: rdm56b
                Enter oob cidr range (normally vlan 1023) in format a.b.c.d/x: 32.68.187.0/26
                Enter start ip for oob range: 32.68.187.6
                Enter end ip for oob range: 32.68.187.62
                Enter pxe cide range in format a.b.c.d/x: 172.30.0.128/25
                Enter oam cidr range (normally vlan 41) in format a.b.c.d/x: 32.68.187.64/26
                Enter storage cidr range in format a.b.c.d/x: 172.31.0.128/25
                Enter calico cidr range in format a.b.c.d/x: 172.29.0.128/25
                Enter overlay cidr range in format a.b.c.d/x: 172.18.0.0/25
                Enter routable cidr range (normally vlan 50) in format a.b.c.d/x: 32.68.187.128/28
                Enter calico ingress cidr range in format a.b.c.d/x: 32.68.187.144/29
                Enter genesis hostname e.g. bsr2r08o019 : rdm56r07o001
                Enter hostname for second controller node e.g. bsr2r09o019: rdm56r08o001
                Enter hostname for third controller node e.g. bsr2r09o019: rdm56r09o001
                Enter hostname for fourth controller node e.g. bsr2r09o019: rdm56r10o001
                Enter ldap mechid to be used by the site e.g m31461@testitservices.atttest.com : m08169@testitservices.atttest.com
                Enter tag/branch name for global repo e.g 2.0.0-rc01 : 2.0.1
                Enter secrets repo name e.g aic-clcp-security-manifests : aic-clcp-security-manifests
                Enter corridor detail e.g 'c3' or 'prod' : c4
                Enter location details in the format City, State, Country e.g REDMOND,WA,US : LosAngeles,CA,US
                Enter physical location id for the site e.g. RDMDWAJC : LSANCA03
                Enter attid for sysadmin e.g.sm451d : sm451d

3. A folder for your site name will be created in /tmp directory with required files

                root@stack:/tmp# cd rdm56b/
                root@stack:/tmp/rdm56b# ls -l
                total 28
                drwxr-xr-x 2 root root 4096 Mar 11 16:01 baremetal
                drwxr-xr-x 2 root root 4096 Mar 11 16:01 deployment
                drwxr-xr-x 3 root root 4096 Mar 11 16:01 network
                drwxr-xr-x 2 root root 4096 Mar 11 16:01 pki
                drwxr-xr-x 2 root root 4096 Mar 11 16:01 profiles
                -rw-r--r-- 1 root root  483 Mar 11 16:01 site-definition.yaml
                drwxr-xr-x 4 root root 4096 Mar 11 16:01 software
                root@stack:/tmp/rdm56b#
                
4. Apart from the site manifest files generated by the script you will have to run the jenkins job below to generate policies.yaml

                https://jenkins-nc.{DOMAIN-NAME}.cci.att.com/job/utils/job/update-host-endpoints/


Note(One Time Setup): 
1. This script will require python3.6 or higher version of python. If using lower version of python install python3-yaml module,
2. Please install ruamel.yaml package on your local
                apt install python3-pip				
                sudo -H pip3 install ruamel.yaml
